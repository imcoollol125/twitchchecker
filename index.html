<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Streamer Live Checker</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link zur CSS-Datei -->

    <style>
        @font-face {
            font-family: 'San Francisco Pro';
            src: url('fonts/SFPRODISPLAYREGULAR.otf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'San Francisco Pro';
            src: url('fonts/SFPRODISPLAYBOLD.otf') format('truetype');
            font-weight: bold;
            font-style: normal;
        }

        body {
            font-family: 'San Francisco Pro', sans-serif;
            background: linear-gradient(135deg, #1f1f1f, #2c2f33);
            color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden;
            animation: bgMove 10s infinite alternate ease-in-out;
        }

        .loader {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 24px;
            color: #f0f0f0;
            animation: fadeOut 0.5s forwards;
        }

        .fade-out {
            animation: fadeOut 0.5s forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes bgMove {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }

        #mainContent {
            display: none; /* Hauptinhalt ist anfangs versteckt */
            text-align: center;
        }

        #liveStatus {
            font-size: 48px;
            margin: 20px 0;
        }

        .live {
            color: #4CAF50; /* Grün für Live-Status */
        }

        .offline {
            color: #FF0000; /* Rot für Offline-Status */
        }
    </style>
</head>
<body>
    <div class="loader">Lädt...</div>
    
    <div id="mainContent">
        <h1>Twitch Streamer Live Checker</h1>
        <input type="text" id="streamerName" placeholder="Streamer Name">
        <input type="text" id="clientId" placeholder="Client ID">
        <input type="text" id="clientSecret" placeholder="Client Secret">
        <button onclick="startChecking()">Überprüfen</button>
        
        <div id="liveStatus" class="offline">Offline</div>
        
        <audio id="liveSound" preload="auto">
            <source src="https://www.dropbox.com/scl/fi/ra6sc2vfog4iw3jicjkbq/livecheckersui.mp3?rlkey=noctntasq9gzjf0db3g7kh65q&st=xjnq4huf&dl=1" type="audio/mp3">
            Ihr Browser unterstützt das Abspielen dieses Audios nicht.
        </audio>
    </div>

    <script>
        let accessToken = ''; // Wird nach der Authentifizierung verwendet
        let streamer = '';
        let isLive = false;

        function startChecking() {
            const clientId = document.getElementById('clientId').value;
            const clientSecret = document.getElementById('clientSecret').value;
            streamer = document.getElementById('streamerName').value;

            if (clientId && clientSecret && streamer) {
                getAccessToken(clientId, clientSecret);
                setInterval(checkStreamerStatus, 60000); // Jede Minute checken
            } else {
                alert('Bitte fülle alle Felder aus (Client ID, Client Secret und Streamer Name)');
            }
        }

        function getAccessToken(clientId, clientSecret) {
            fetch('https://id.twitch.tv/oauth2/token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: new URLSearchParams({
                    'client_id': clientId,
                    'client_secret': clientSecret,
                    'grant_type': 'client_credentials'
                })
            })
            .then(response => response.json())
            .then(data => {
                accessToken = data.access_token;
                checkStreamerStatus();
            });
        }

        function checkStreamerStatus() {
            const clientId = document.getElementById('clientId').value;

            if (!streamer || !clientId) return;

            fetch(`https://api.twitch.tv/helix/streams?user_login=${streamer}`, {
                headers: {
                    'Client-ID': clientId,
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                let liveStatus = document.getElementById('liveStatus');
                if (data.data && data.data.length > 0) {
                    if (!isLive) {
                        playSound();
                    }
                    liveStatus.textContent = 'Live!';
                    liveStatus.classList.add('live');
                    liveStatus.classList.remove('offline');
                    isLive = true;
                } else {
                    liveStatus.textContent = 'Offline';
                    liveStatus.classList.remove('live');
                    liveStatus.classList.add('offline');
                    isLive = false;
                }
            })
            .catch(error => console.error('Error fetching streamer status:', error));
        }

        function playSound() {
            const sound = document.getElementById('liveSound');
            sound.play().catch(error => console.log('Error playing sound:', error));
        }

        // Ladespinner nach 2,5 Sekunden ausblenden und Hauptinhalt anzeigen
        window.onload = function() {
            setTimeout(() => {
                document.querySelector('.loader').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
            }, 2500); // Auf 2,5 Sekunden geändert
        }
    </script>
</body>
</html>
